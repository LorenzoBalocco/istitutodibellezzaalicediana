# Sitemap automatica — 2026-02-13-16-07-37

## Obiettivo

Riscrivere `src/app/sitemap.ts` in modo che si aggiorni automaticamente ogni volta che viene aggiunta una nuova pagina (`page.tsx`) al progetto, senza intervento manuale.

## Approccio tecnico

### Perché non uno "script separato"

Next.js App Router ha una convention nativa: il file `src/app/sitemap.ts` viene eseguito server-side a **build time** (SSG). È il posto corretto per generare la sitemap — nessuno script esterno necessario.

### Meccanismo di auto-discovery

Al build time, `sitemap.ts` userà il modulo Node.js `fs` per:

1. Scansionare ricorsivamente `src/app/` alla ricerca di tutti i file `page.tsx`
2. Convertire i path del filesystem in segmenti URL:
   - `src/app/page.tsx` → `/`
   - `src/app/trattamenti/page.tsx` → `/trattamenti`
   - `src/app/trattamenti/sottocategoria/page.tsx` → `/trattamenti/sottocategoria`
3. Escludere automaticamente:
   - Route groups `(parentesi)` — usati per layout grouping, non creano segmento URL
   - Percorsi `api/`, `_` (convenzione privata Next.js)
   - Segmenti dinamici `[slug]` — non applicabili a questo sito static
4. Assegnare `priority` e `changeFrequency` in base alla profondità del percorso:
   - Homepage (`/`): priority 1.0, `monthly`
   - Top-level (`/trattamenti`, `/contatti`, ...): priority 0.8, `monthly`
   - Sotto-pagine (2+ livelli): priority 0.6, `monthly`

### File coinvolti

| File | Azione |
|------|--------|
| `src/app/sitemap.ts` | **Riscrittura completa** — da lista hardcoded a auto-discovery |

### Nessun file aggiunto o dipendenza nuova

Tutto si basa su `fs` e `path` (Node.js built-in, già disponibili nel runtime Next.js server-side).

---

---

## Stato finale

**Build: ✓ 0 errori** — `/sitemap.xml` generata come pagina statica (SSG).

### File modificati
- `src/app/sitemap.ts` — riscrittura completa

### Decisioni tecniche
- `fs.readdirSync` con `process.cwd()` funziona correttamente a build time in Next.js
- La homepage `/` viene aggiunta manualmente prima della scansione per garantirne la presenza anche se in `(route-group)`
- `new Set()` rimuove eventuali duplicati prodotti dalla logica dei route groups
- `changeFrequency` uniforme `"monthly"` per tutte le pagine (sito vetrina statico)
- TypeScript: tipo esplicito `MetadataRoute.Sitemap[number]["changeFrequency"]` per evitare errori di inferenza
